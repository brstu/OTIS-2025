#include <iostream>
#include "model.h"
#include "pid.h"

/**
 * @brief Точка входа в программу моделирования PID-регулятора.
 *
 * Программа моделирует работу дискретного PID-регулятора для управления
 * линейной моделью объекта. Пользователь вводит коэффициенты модели,
 * начальное и целевое значение температуры, а также количество шагов моделирования.
 *
 * Алгоритм работы:
 * - Запрос коэффициентов линейной модели a и b.
 * - Запрос начальной температуры и целевой температуры.
 * - Запрос числа шагов моделирования.
 * - На каждом шаге вычисляется отклонение между целевой и текущей температурой.
 * - PID-регулятор формирует управляющее воздействие.
 * - Линейная модель рассчитывает новое значение температуры.
 * - Результаты выводятся в консоль.
 *
 * @return код завершения программы.
 */
int main()
{
    const double K  = 0.1;  ///< коэффициент передачи
    const double T  = 10.0; ///< постоянная интегрирования
    const double Td = 0.0;  ///< постоянная дифференцирования
    const double T0 = 1.0;  ///< шаг
    
    pid_coeffs coeffs(K, T, Td, T0);
    pid PID(coeffs, 1, 2, 3);

    double a; ///< коэффициент модели a
    double b; ///< коэффициент модели b
    double y; ///< текущее значение температуры
    double w; ///< целевая температура
    int n;    ///< количество шагов моделирования

    std::cout << "Enter the coefficients A and B of the linear model -> ";
    std::cin >> a >> b;
    std::cout << "Enter initial temperature -> ";
    std::cin >> y;
    std::cout << "Enter target temperature -> ";
    std::cin >> w;
    std::cout << "Enter number of steps -> ";
    std::cin >> n;

    double e; ///< значение отклонения 
    double u; ///< значение управляющего воздействия 

    for (int i = 0; i < n; i++)
    {
        e = w - y;              ///< вычисление значение отклонения 
        u = PID.process(e);     ///< нахождение значения управляющего воздействия
        y = linear(y, u, a, b); ///< расчёт новой температуры по модели

        std::cout << "Step " << i + 1 << " - e = " << e << ", u = " << u << ", y = " << y << ";\n"; 
    }

    return 0;
}