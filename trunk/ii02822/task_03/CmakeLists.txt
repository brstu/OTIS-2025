cmake_minimum_required(VERSION 3.15)
project(lab3_ii02822)

set(CMAKE_CXX_STANDARD 17)

# Основная программа - указываем пути к файлам в src/
add_executable(lab3_ii02822
    src/main.cpp
    src/pid_controller.cpp
    src/model.cpp
)

# Включаем директории для основной программы
target_include_directories(lab3_ii02822 PRIVATE src)

# Google Test
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
  DOWNLOAD_EXTRACT_TIMESTAMP TRUE
)
FetchContent_MakeAvailable(googletest)

enable_testing()

# Тестовый исполняемый файл - указываем правильные пути
add_executable(pid_tests_ii02822
    test/pid_controller_test.cpp  
    src/pid_controller.cpp
    src/model.cpp
)

# Включаем директории для тестов
target_include_directories(pid_tests_ii02822 PRIVATE src test)

# Линковка с Google Test
target_link_libraries(pid_tests_ii02822 PRIVATE 
    gtest 
    gtest_main
)

# Регистрация теста
add_test(NAME PIDControllerTests COMMAND pid_tests_ii02822)

# Автоматическое обнаружение тестов
include(GoogleTest)
gtest_discover_tests(pid_tests_ii02822)